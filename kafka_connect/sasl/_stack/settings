#!/usr/bin/env bash

# START CONFIGURATION
DOLLAR='$'
export VCW_STACK_GLOBAL_STACKS="vcwc/confluent/kafka_connect/sasl"
export VCW_STACK_GLOBAL_STACKNAMES="vcw_stack_kafka_connect"
export VCW_STACK_GLOBAL_BOOTSTACKS="vcw_stack_kafka_connect"
export VCW_STACK_GLOBAL_RUNSTACKS=""
export VCW_STACK_GLOBAL_VOLUME_LIST="\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_secrets_volume,\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_connect_secrets_volume,\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_data_volume,\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_jars_volume"
export VCW_STACK_GLOBAL_VOLUME_INITIALISED=""
# END CONFIGURATION

# START GLOBAL SETTINGS
export VCW_STACK_GLOBAL='\
$VCW_STACK_GLOBAL_SERVICE_NAME,\
$VCW_STACK_GLOBAL_IMAGE_NAME,\
$VCW_STACK_KAFKA_CONNECT_ENVIRONMENT,\
$VCW_STACK_KAFKA_CONNECT_COMMAND,\
$VCW_STACK_KAFKA_CONNECT_VOLUMES,\
$VCW_STACK_KAFKA_CONNECT_NETWORKS,\
$VCW_STACK_KAFKA_CONNECT_DEPLOY_MODE,\
$VCW_STACK_GLOBAL_VOLUMES,\
$VCW_STACK_GLOBAL_NETWORKS'
export VCW_STACK_GLOBAL_SERVICE_NAME="kafka_connect"
export VCW_STACK_GLOBAL_IMAGE_NAME="vcwc/confluent.kafka_connect.sasl"
export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT="\
'CONNECT_REST_ADVERTISED_HOST_NAME=kafka_connect',\
'CONNECT_REST_PORT=8083',\
'CONNECT_GROUP_ID=${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect',\
'CONNECT_CONFIG_STORAGE_TOPIC=${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_configs',\
'CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR=3',\
'CONNECT_OFFSET_FLUSH_INTERVAL_MS=10000',\
'CONNECT_OFFSET_STORAGE_TOPIC=${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_offsets',\
'CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR=3',\
'CONNECT_STATUS_STORAGE_TOPIC=${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_status',\
'CONNECT_STATUS_STORAGE_REPLICATION_FACTOR=3',\
'CONNECT_KEY_CONVERTER=org.apache.kafka.connect.storage.StringConverter',\
'CONNECT_VALUE_CONVERTER=io.confluent.connect.avro.AvroConverter',\
'CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL=${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_URL}',\
'CONNECT_VALUE_CONVERTER_BASIC_AUTH_CREDENTIALS_SOURCE=USER_INFO',\
'CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_BASIC_AUTH_USER_INFO=${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_API_KEY}:${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_API_SECRET}',\
'CONNECT_INTERNAL_KEY_CONVERTER=org.apache.kafka.connect.json.JsonConverter',\
'CONNECT_INTERNAL_VALUE_CONVERTER=org.apache.kafka.connect.json.JsonConverter',\
'CONNECT_PLUGIN_PATH=/usr/share/java,/usr/share/confluent-hub-components',\
'CONNECT_LOG4J_LOGGERS=org.apache.zookeeper=ERROR,org.I0Itec.zkclient=ERROR,org.reflections=ERROR',\
'CONNECT_BOOTSTRAP_SERVERS=${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CLOUD_BOOTSTRAP_SERVERS}',\
'CONNECT_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=HTTPS',\
'CONNECT_SECURITY_PROTOCOL=SASL_SSL',\
'CONNECT_SASL_JAAS_CONFIG=org.apache.kafka.common.security.plain.PlainLoginModule required username=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SASL_JAAS_CONFIG_CLUSTER_API_KEY}\" password=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SASL_JAAS_CONFIG_CLUSTER_API_SECRET}\";',\
'CONNECT_SASL_MECHANISM=PLAIN',\
'CONNECT_PRODUCER_SECURITY_PROTOCOL=SASL_SSL',\
'CONNECT_PRODUCER_SASL_JAAS_CONFIG=org.apache.kafka.common.security.plain.PlainLoginModule required username=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_PRODUCER_SASL_JAAS_CONFIG_CLUSTER_API_KEY}\" password=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_PRODUCER_SASL_JAAS_CONFIG_CLUSTER_API_SECRET}\";',\
'CONNECT_PRODUCER_SASL_MECHANISM=PLAIN',\
'CONNECT_CONSUMER_SECURITY_PROTOCOL=SASL_SSL',\
'CONNECT_CONSUMER_SASL_JAAS_CONFIG=org.apache.kafka.common.security.plain.PlainLoginModule required username=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CONSUMER_SASL_JAAS_CONFIG_CLUSTER_API_KEY}\" password=\"${DOLLAR}{VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CONSUMER_SASL_JAAS_CONFIG_CLUSTER_API_SECRET}\";',\
'CONNECT_CONSUMER_SASL_MECHANISM=PLAIN'"
export VCW_STACK_KAFKA_CONNECT_COMMAND=
export VCW_STACK_KAFKA_CONNECT_VOLUMES="\
'${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_connect_secrets_volume:/etc/kafka-connect/secrets',\
'${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_secrets_volume:/etc/kafka/secrets',\
'${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_data_volume:/var/lib/kafka/data',\
'${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_jars_volume:/etc/kafka-connect/jars'"
export VCW_STACK_KAFKA_CONNECT_NETWORKS="${DOLLAR}{VCW_STACK_GLOBAL_NETWORKLOCAL}_overlay"
export VCW_STACK_KAFKA_CONNECT_DEPLOY_MODE="replicated"
export VCW_STACK_GLOBAL_VOLUMES="\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_connect_secrets_volume: { external: true },\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_secrets_volume: { external: true },\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_data_volume: { external: true },\
${DOLLAR}{VCW_STACK_GLOBAL_STACKPREFIX}_kafka_connect_jars_volume: { external: true }"
export VCW_STACK_GLOBAL_NETWORKS="${DOLLAR}{VCW_STACK_GLOBAL_NETWORKLOCAL}_overlay: { external: true }"
# END GLOBAL SETTINGS


# START SETTINGS kafka_connect.base
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CLOUD_BOOTSTRAP_SERVERS=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SASL_JAAS_CONFIG_CLUSTER_API_KEY=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SASL_JAAS_CONFIG_CLUSTER_API_SECRET=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_URL=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_API_KEY=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_SCHEMA_REGISTRY_API_SECRET=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_PRODUCER_SASL_JAAS_CONFIG_CLUSTER_API_KEY=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_PRODUCER_SASL_JAAS_CONFIG_CLUSTER_API_SECRET=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CONSUMER_SASL_JAAS_CONFIG_CLUSTER_API_KEY=
#export VCW_STACK_KAFKA_CONNECT_ENVIRONMENT_CONNECT_CONSUMER_SASL_JAAS_CONFIG_CLUSTER_API_SECRET=
export VCW_STACK_KAFKA_CONNECT_MODULE_KAFKA_CONNECT_PORT="8083"
export VCW_STACK_KAFKA_CONNECT_PORTS="${VCW_STACK_KAFKA_CONNECT_MODULE_KAFKA_CONNECT_PORT}:8083"
export VCW_STACK_KAFKA_CONNECT_DEPLOY_RESOURCES_LIMITS_MEMORY="1536m"
export VCW_STACK_KAFKA_CONNECT_DEPLOY_RESOURCES_RESERVATIONS_MEMORY="1024m"
# END SETTINGS kafka_connect.base

# START TOPLEVEL SETTINGS
# END TOPLEVEL SETTINGS
